-- Services
local Players = game:GetService("Players")
local Camera = game:GetService("Workspace").CurrentCamera
local UserInputService = game:GetService("UserInputService")

-- Settings
local smoothness = 0.5
local aimMethod = "Nearest" -- "Nearest" or "LowestDistance"
local holdKey = Enum.KeyCode.Q
local throughWalls = false
local teamCheck = true
local aliveCheck = true
local goddedCheck = true
local lockOnHold = true

-- GUI
local gui = Instance.new("ScreenGui")
gui.Name = "ESP_Aimbot_UI"
gui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 200, 0, 300)
frame.Position = UDim2.new(0.5, -100, 0.5, -150)
frame.AnchorPoint = Vector2.new(0.5, 0.5)
frame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
frame.BorderSizePixel = 0
frame.Parent = gui

local title = Instance.new("TextLabel")
title.Text = "ESP & Aimbot Settings"
title.Size = UDim2.new(1, 0, 0, 30)
title.Position = UDim2.new(0, 0, 0, 0)
title.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
title.BorderSizePixel = 0
title.Font = Enum.Font.SourceSansBold
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Parent = frame

-- Add more UI elements for options...

-- Functions
local function createESP(player)
    local espBox = Instance.new("BoxHandleAdornment")
    espBox.Adornee = player.Character.HumanoidRootPart
    espBox.Size = player.Character.HumanoidRootPart.Size
    espBox.Color3 = Color3.new(1, 0, 0)
    espBox.AlwaysOnTop = true
    espBox.Parent = player.Character

    local nameLabel = Instance.new("BillboardGui")
    nameLabel.Size = UDim2.new(0, 100, 0, 20)
    nameLabel.StudsOffset = Vector3.new(0, 2, 0)
    nameLabel.Adornee = player.Character.Head
    nameLabel.Parent = player.Character

    local nameLabelText = Instance.new("TextLabel")
    nameLabelText.Text = player.Name
    nameLabelText.Size = UDim2.new(1, 0, 1, 0)
    nameLabelText.BackgroundTransparency = 1
    nameLabelText.TextColor3 = Color3.new(1, 1, 1)
    nameLabelText.TextStrokeTransparency = 0.5
    nameLabelText.TextStrokeColor3 = Color3.new(0, 0, 0)
    nameLabelText.Parent = nameLabel
end

local function destroyESP(player)
    local character = player.Character
    if character then
        for _, child in ipairs(character:GetChildren()) do
            if child:IsA("BoxHandleAdornment") or child:IsA("BillboardGui") then
                child:Destroy()
            end
        end
    end
end

local function getAimTarget()
    local target = nil
    local targetDistance = math.huge

    for _, player in ipairs(Players:GetPlayers()) do
        if player.Character and player.Character:FindFirstChild("Humanoid") and player.Character.Humanoid.Health > 0 then
            if teamCheck and player.Team ~= game.Players.LocalPlayer.Team then
                local rootPart = player.Character:FindFirstChild("HumanoidRootPart")
                if rootPart then
                    local screenPosition, onScreen = Camera:WorldToViewportPoint(rootPart.Position)
                    if onScreen then
                        local distance = (Vector2.new(screenPosition.X, screenPosition.Y) - Vector2.new(0.5, 0.5)).Magnitude
                        if distance < targetDistance then
                            target = rootPart
                            targetDistance = distance
                        end
                    end
                end
            end
        end
    end

    return target
end

local function aimAt(position)
    local screenSize = Camera.ViewportSize
    local centerScreen = Vector2.new(screenSize.X / 2, screenSize.Y / 2)
    local aimDirection = (position - centerScreen).unit

    if smoothness == 0 then
        mousemoverel(aimDirection.X, aimDirection.Y)
    else
        local currentPos = Vector2.new(mouse.X, mouse.Y)
        local newPos = currentPos + (aimDirection * smoothness)
        mousemoverel(newPos.X - currentPos.X, newPos.Y - currentPos.Y)
    end
end

-- Event handling
Players.PlayerAdded:Connect(function(player)
    createESP(player)
end)

Players.PlayerRemoving:Connect(function(player)
    destroyESP(player)
end)

UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == holdKey then
        if lockOnHold then
            local target = getAimTarget()
            if target then
                aimAt(Camera:WorldToScreenPoint(target.Position))
            end
        end
    end
end)

-- Initialization
for _, player in ipairs(Players:GetPlayers()) do
    createESP(player)
end
```
